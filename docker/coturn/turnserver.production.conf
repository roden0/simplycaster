# COTURN Production Configuration
# SimplyCaster ICE Server Integration

# Listening ports and interfaces
listening-port=3478
tls-listening-port=5349
alt-listening-port=443
alt-tls-listening-port=443

# External IP (will be set via environment variable)
external-ip=${COTURN_EXTERNAL_IP}

# Relay ports range
min-port=49152
max-port=65535

# Authentication
use-auth-secret
static-auth-secret=${COTURN_SECRET}
realm=${COTURN_REALM}

# SSL/TLS Configuration
cert=/etc/ssl/coturn/cert.pem
pkey=/etc/ssl/coturn/key.pem
cipher-list="ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS"
ec-curve-name=prime256v1
dh-file=/etc/ssl/coturn/dh2048.pem

# Security settings
no-multicast-peers
no-cli
no-tlsv1
no-tlsv1_1
no-stdout-log
syslog

# Performance and reliability
total-quota=100
bps-capacity=0
stale-nonce=600
max-allocate-lifetime=3600
channel-lifetime=600
permission-lifetime=300

# Logging (production level)
log-file=/var/log/coturn/turnserver.log
verbose
log-binding
no-software-attribute

# Database for persistent storage (optional)
# userdb=/var/lib/coturn/turndb

# Mobility support
mobility
keep-address-family

# Security hardening
secure-stun
check-origin-consistency
fingerprint
lt-cred-mech

# Rate limiting
max-allocate-timeout=60
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Allow specific ranges for production
allowed-peer-ip=0.0.0.0-255.255.255.255

# Process management
pidfile=/var/run/turnserver.pid
proc-user=turnserver
proc-group=turnserver

# Additional security
no-tcp-relay
no-udp-relay
stun-only

# Monitoring
prometheus
prometheus-port=9641